# Description: Freedesktop.org message bus system
# URL: http://www.freedesktop.org/wiki/Software/dbus/
# Packager: pierre at nutyx dot org
# Depends on: expat xorg-libx11 xorg-libsm xorg-libice 
PKGMK_GROUPS=(doc devel)

name=dbus
version=1.10.6
release=1

source=(http://dbus.freedesktop.org/releases/dbus/$name-$version.tar.gz \
       dbus.system-local.conf)

build() {
	cd $name-$version
	./configure --prefix=/usr 										\
				--sysconfdir=/etc 									\
				--localstatedir=/var 								\
				--libexecdir=/usr/lib/dbus-1.0  					\
				--with-dbus-user=dbus 								\
				--with-system-pid-file=/run/dbus/pid 				\
				--with-system-socket=/run/dbus/system_bus_socket 	\
				--with-console-auth-dir=/run/console/ 				\
				--enable-inotify 									\
				--disable-verbose-mode                              \
				--disable-static 									\
				--disable-tests 									\
				--disable-asserts 									\
				--with-systemdsystemunitdir=/usr/lib/systemd/system \
				--enable-systemd 									\
				--enable-user-session
	make
	make DESTDIR=$PKG install
mkdir -p $PKG/lib
mv -v $PKG/usr/lib/libdbus-1.so.* $PKG/lib
ln -sfv ../../lib/$(readlink /usr/lib/libdbus-1.so) $PKG/usr/lib/libdbus-1.so
mkdir -p $PKG/var/lib	
ln -sfv /etc/machine-id $PKG/var/lib/dbus
}
